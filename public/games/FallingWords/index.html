<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Falling Words</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      background: #0d1320;
      color: #e8ecf4;
      font-family: "Courier New", monospace;
    }
    .layout {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    #container { position: relative; }
    #game {
      width: 640px;
      height: 480px;
      background: linear-gradient(180deg, #121b2c, #0b101c);
      border: 1px solid #1f2b3a;
      overflow: hidden;
      position: relative;
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
    }
    .word {
      position: absolute;
      color: #ffd447;
      font-size: 18px;
      font-weight: bold;
      pointer-events: none;
      text-shadow: 0 0 6px rgba(0,0,0,0.5);
    }
    #hud {
      position: absolute;
      top: 8px;
      left: 10px;
      font-size: 14px;
      color: #e8ecf4;
      text-shadow: 0 0 8px rgba(0,0,0,0.35);
    }
    #input {
      width: 100%;
      padding: 10px;
      border: 1px solid #2d3e55;
      background: #0b101c;
      color: #e8ecf4;
      font-size: 16px;
      font-family: "Courier New", monospace;
      outline: none;
    }
    #target-display {
      margin-top: 6px;
      font-size: 16px;
    }
    #info {
      max-width: 240px;
      text-align: left;
      font-size: 14px;
      line-height: 1.5;
      color: #d6deff;
      text-shadow: 0 0 6px rgba(255,255,255,0.2);
    }
    .typed { color: #7fffd4; }
    .remaining { color: #ffd447; }
    #menu-link {
      display: inline-block;
      margin-top: 12px;
      padding: 8px 12px;
      background: #ffd447;
      color: #0d1320;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(255,212,71,0.45);
    }
    #overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    #overlay.show {
      visibility: visible;
      opacity: 1;
    }
    .modal {
      background: #0e1424;
      border: 1px solid #1f2b3a;
      padding: 20px 24px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 12px 24px rgba(0,0,0,0.5);
    }
    .modal h2 { margin: 0 0 8px; letter-spacing: 1px; color: #ffd447; }
    button {
      margin-top: 10px;
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      font-family: "Courier New", monospace;
      background: linear-gradient(135deg, #ffd447, #7fffd4);
      color: #0d1320;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,0.4);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 10px 20px rgba(0,0,0,0.45); }
    button:active { transform: translateY(1px); }
    #leaderboard {
      margin-top: 12px;
      padding: 12px;
      border: 1px solid #1f2b3a;
      border-radius: 10px;
      background: rgba(15, 23, 38, 0.55);
    }
    #leaderboard .label {
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 1px;
      color: #d6deff;
      margin-bottom: 6px;
    }
    #leaderboard-list { margin: 0; padding-left: 18px; }
    #leaderboard-list li { margin-bottom: 4px; }
    #leaderboard-list li.empty {
      list-style: none;
      padding-left: 0;
      color: #9fb0d8;
    }
  </style>
</head>
<body>
  <div class="layout">
    <div>
      <div id="game">
        <div id="hud">Score: <span id="score">0</span> | Lives: <span id="lives">3</span> | Best: <span id="best">0</span></div>
      </div>
      <input id="input" type="text" autocomplete="off" placeholder="Type the falling word..." />
      <div id="target-display"></div>
      <div id="overlay">
        <div class="modal">
          <h2>Game Over</h2>
          <p>Final Score: <span id="final-score">0</span></p>
          <button id="restart">Play Again</button>
        </div>
      </div>
    </div>
    <div id="info">
      Type the falling words before they hit the bottom. Match letters in order; correct words grant +10 points. Letters you typed highlight in green. Words missed deduct 10 points.<br>
      Project of CCIS students
      <div id="leaderboard">
        <div class="label">Leaderboard</div>
        <ol id="leaderboard-list"></ol>
      </div>
    </div>
  </div>

  <script src="../leaderboard.js"></script>
  <script>
    const wordsList = [
      "apple","house","water","river","stone","light","night","music","happy","green",
      "earth","cloud","breeze","silent","quick","brown","fox","jumps","over","lazy",
      "dog","summer","winter","autumn","spring","dream","magic","storm","calm","ocean",
      "mountain","forest","desert","island","garden","flower","bridge","castle","gold",
      "silver","candle","shadow","spark","flame","whisper","sudden","bright","calmly","brave"
    ];

    const gameEl = document.getElementById("game");
    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const bestEl = document.getElementById("best");
    const inputEl = document.getElementById("input");
    const targetDisplay = document.getElementById("target-display");
    const overlay = document.getElementById("overlay");
    const finalScoreEl = document.getElementById("final-score");
    const restartBtn = document.getElementById("restart");
    const leaderboardListEl = document.getElementById("leaderboard-list");

    const leaderboard = createLeaderboard({
      storageKey: "fallingWordsLeaderboard",
      nameKey: "fallingWordsPlayerName",
      listElement: leaderboardListEl
    });

    let words = [];
    let spawnTimer = 0;
    let score = 0;
    let lives = 3;
    let gameOver = false;
    let last = 0;

    function spawnWord() {
      if (gameOver) return;
      const text = wordsList[Math.floor(Math.random() * wordsList.length)];
      const el = document.createElement("div");
      el.className = "word";
      el.textContent = text;
      const x = Math.random() * (gameEl.clientWidth - 80);
      gameEl.appendChild(el);
      words.push({ text, el, x, y: -20, speed: 40 + Math.random() * 60 });
      updateTargetDisplay();
    }

    function updateTargetDisplay() {
      const target = words[0];
      if (!target) {
        targetDisplay.textContent = "Waiting for next word...";
        return;
      }
      const typed = inputEl.value;
      const matched = target.text.slice(0, typed.length);
      const remaining = target.text.slice(typed.length);
      targetDisplay.innerHTML = `<span class="typed">${matched}</span><span class="remaining">${remaining}</span>`;
    }

    function updateHud(renderBoard = false) {
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      bestEl.textContent = leaderboard.format(leaderboard.best());
      if (renderBoard) leaderboard.render();
    }

    function update(dt) {
      if (gameOver) return;
      spawnTimer += dt;
      if (spawnTimer > 1.6) {
        spawnWord();
        spawnTimer = 0;
      }

      for (let i = words.length - 1; i >= 0; i--) {
        const w = words[i];
        w.y += w.speed * dt;
        w.el.style.transform = `translate(${w.x}px, ${w.y}px)`;
        if (w.y > gameEl.clientHeight) {
          gameEl.removeChild(w.el);
          words.splice(i, 1);
          score = Math.max(0, score - 10);
          lives = Math.max(0, lives - 1);
          if (lives <= 0) {
            updateHud(true);
            endRun();
            return;
          }
          updateHud();
        }
      }
    }

    function onInput() {
      if (gameOver) return;
      if (!words[0]) return;
      const target = words[0];
      const typed = inputEl.value;
      if (!target.text.startsWith(typed)) {
        // wrong char -> clear input to keep flow
        inputEl.value = "";
      }
      if (typed === target.text) {
        gameEl.removeChild(target.el);
        words.shift();
        score += 10;
        updateHud();
        inputEl.value = "";
      }
      updateTargetDisplay();
    }

    inputEl.addEventListener("input", onInput);
    inputEl.addEventListener("keydown", e => { if (e.key === "Enter") inputEl.value = ""; });

    function endRun() {
      if (gameOver) return;
      gameOver = true;
      finalScoreEl.textContent = score;
      overlay.classList.add("show");
      leaderboard.record(score);
      updateHud(true);
    }

    function resetGame() {
      words.forEach(w => gameEl.removeChild(w.el));
      words = [];
      spawnTimer = 0;
      score = 0;
      lives = 3;
      gameOver = false;
      last = 0;
      overlay.classList.remove("show");
      inputEl.value = "";
      targetDisplay.textContent = "Type the falling word...";
      updateHud(true);
      spawnWord();
    }

    function loop(ts) {
      if (!last) last = ts;
      const dt = Math.min((ts - last) / 1000, 0.05);
      last = ts;
      update(dt);
      requestAnimationFrame(loop);
    }

    restartBtn.addEventListener("click", resetGame);

    leaderboard.load();
    leaderboard.render();
    updateHud(true);
    resetGame();
    requestAnimationFrame(loop);
    inputEl.focus();
  </script>
</body>
</html>
